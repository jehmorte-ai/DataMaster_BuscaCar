classDiagram
    %% Pipeline + Observabilidade + Segurança

    class JobIngestao {
      +job_id: string
      +fonte: FonteTipo
      +schedule: string?  <<cron>>
      +rodar(): void
    }

    class ExtracaoFipeNovoComLog {
      +fetch(): RawFrame
      +parse(): TabelaFIPE
      +uploadBronze(): void
    }

    class ExtracaoSusep {
      +fetch(): RawFrame
      +parse(): TabelaSUSEP
      +uploadBronze(): void
    }

    class Conformidade {
      +harmonizarNomes(): void
      +normalizarChaves(): void
      +validarRegras(): void
    }

    class TransformPrata {
      +limparPadronizar(): void
      +regrasQualidade(): void
    }

    class TransformGold {
      +construirMarts(): void
      +agregacoesMetricas(): void
      +publicarParaBI(): void
    }

    class RunLog {
      +run_id: string
      +job: string
      +status: string <<RUNNING|SUCCESS|FAILED>>
      +started_at: timestamp
      +ended_at: timestamp
      +error_message: string?
      +write(): void
    }

    class UpTimeRobotCheck {
      +endpoint: string
      +periodo_s: int
      +verificar(): HealthStatus
      +notificar(): void
    }

    class DLPService {
      +mask(campo, estrategia): string
      +scanTabela(tabela): Report
    }

    class IAMPolicy {
      +papel: string
      +membro: string
      +aplicar(): void
    }

    class FonteTipo {
      <<enumeration>>
      FIPE
      SUSEP
      CSV_SEGUROS
    }

    class HealthStatus {
      <<enumeration>>
      OK
      WARN
      FAIL
    }

    JobIngestao "1" --> "1" ExtracaoFipeNovoComLog : executa (FIPE)
    JobIngestao "1" --> "1" ExtracaoSusep : executa (SUSEP)
    JobIngestao "1" --> "1" Conformidade : pós-tratamento

    ExtracaoFipeNovoComLog --> RunLog : write_run_log
    ExtracaoSusep --> RunLog : write_run_log
    Conformidade --> RunLog : write_run_log
    TransformPrata --> RunLog : write_run_log
    TransformGold --> RunLog : write_run_log

    UpTimeRobotCheck --> RunLog : consulta último run
    DLPService --> TransformPrata : aplicar mascaramento
    IAMPolicy --> JobIngestao : restringe execução
